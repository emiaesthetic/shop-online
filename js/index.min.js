!function(){"use strict";const e="https://bristle-wonderful-eagle.glitch.me/",t="https://gorest.co.in/public/v2/",n="favoriteGoodsID",a="cartGoodsID",c={desktopWide:1400,desktop:1200,laptop:1024,tablet:768,mobileLg:576,mobile:480},r=async(e,t)=>await(async(e,t,{method:n="GET",headers:a,body:c,callback:r})=>{try{const i=`${e}${t}`,s={method:n};a&&(s.headers=a),c&&(s.body=JSON.stringify(c));const o=await fetch(i,s);if(!o.ok)throw new Error(`Ошибка ${o.status}`);const l=await o.json();if(r)return r(null,l)}catch(e){return r(e)}})(e,t,{callback:(e,t)=>{if(!e)return t;console.error(e)}}),i=e=>e.classList.contains("is-open"),s=(e,t)=>{e.setAttribute("aria-hidden",!i(t))},o=(e,t)=>{e.setAttribute("aria-expanded",i(t))},l=(e,t)=>{const n=t.map((e=>(e=>{const t=document.createElement("li");t.classList.add("menu__subitem");const n=document.createElement("a");return n.classList.add("menu__sublink","underline-link"),n.href=`category.html?category=${e}`,n.textContent=e,t.append(n),t})(e)));e.append(...n)},d=async()=>{const t=document.querySelector(".menu"),n=document.querySelector(".menu__list"),a=document.querySelector(".menu__button"),i=document.querySelectorAll(".dropdown"),[d,u]=document.querySelectorAll(".menu__sublist--columns-2");a.addEventListener("click",(()=>{t.classList.toggle("is-open"),s(n,t),o(a,t)})),i.forEach((e=>{const t=e.querySelector(".dropdown__button"),n=e.querySelector(".dropdown__content");t.addEventListener("click",(()=>{t.classList.toggle("is-open"),o(t,t),n.classList.toggle("is-open"),s(n,n)}))})),window.addEventListener("resize",(()=>{(e=>{e.forEach((e=>{const t=e.querySelector(".dropdown__content");window.innerWidth>=c.mobileLg?t.setAttribute("aria-hidden","true"):t.setAttribute("aria-hidden","false")}))})(i)}));const m=await r(e,"api/categories");l(d,m),l(u,m)},u=({tag:e,className:t,src:n,width:a,height:c,alt:r})=>{const i=new Image(a,c);i.src=n,i.loading="lazy",r?i.alt=r:i.ariaHidden=!0;const s=document.createElement(e);return s.className=t,s.append(i),{imageWrapper:s,image:i}},m=()=>{const e=Array.from(document.images);return new Promise((t=>{let n=0;const a=()=>{n++,n===e.length&&t()};e.forEach((e=>{const t=new Image;t.src=e.src,t.onload=a,t.onerror=a}))}))},_=e=>new Intl.NumberFormat("ru-RU").format(Math.floor(e))+" ₽",p=(e,t,n=1)=>{const a=e*(t/100);return Math.floor(e-a)*n},h=(e,t=1)=>{const n=.01,a=(e-.2*e)*(n*Math.pow(1.01,12))/(Math.pow(1.01,12)-1);return Math.floor(a)*t},g=e=>e.reduce(((e,{price:t,discount:n,quantity:a})=>e+=n?p(t,n,a):t*a),0),y=e=>e.reduce(((e,{price:t,quantity:n})=>e+t*n),0),b=()=>{document.querySelectorAll(".card").forEach((e=>{const t=e.querySelector(".card__price"),n=e.querySelector(".card__original-price");n&&(Object.values(c).forEach((e=>{window.innerWidth===e&&n.classList.remove("is-hidden")})),t.offsetWidth>=e.offsetWidth&&n.classList.add("is-hidden"))}))},f=()=>document.querySelector(".loader")?.remove(),v=async(t,n="h3")=>{const a=document.querySelector(".goods__list");a.innerHTML="";const c=[];t.forEach((t=>{const r=document.createElement("li");r.classList.add("goods__item");const{card:i,image:s}=(({id:t,title:n,image:a,price:c,discount:r},i="h3")=>{const{imageWrapper:s,image:o}=u({tag:"picture",className:"card__image",src:`${e}${a}`,width:420,height:295,alt:n}),l=document.createElement("article");return l.classList.add("card"),l.innerHTML=`\n    <a class="card__image-link" href="product.html?id=${t}">\n      ${s.outerHTML}\n      ${r?`<span class="discount discount--lb">-${r}%</span>`:""}\n    </a>\n\n    <div class="card__content">\n      <div class="card__price">\n      ${r?`\n        <span class="card__current-price">\n          ${_(p(c,r))}\n        </span>\n        <del class="card__original-price">\n          ${_(c)}\n        </del>\n      `:`\n        <span class="card__current-price">\n            ${_(c)}\n        </span>\n      `}\n      </div>\n      <${i} class="card__title" title="${n}">\n        <a class="card__link" href="product.html?id=${t}">\n          ${n}\n        </a>\n      </${i}>\n    </div>\n  `,{card:l,image:o}})(t,n);c.push(s),r.append(i),a.append(r)}));try{await m()}catch(e){console.error(e)}finally{f()}b(),window.addEventListener("resize",b)},q=async()=>{const t=(e=>e.sort(((e,t)=>t.discount-e.discount)))(await r(e,"api/goods/discount"));v(t.slice(0,8))},S=(e,t)=>{const n={days:["день","дня","дней"],hours:["час","часа","часов"],minutes:["минута","минуты","минут"]},a=[2,0,1,1,1,2];if(t%100>4&&t%100<20)return n[e][2];return n[e][a[t%10<5?t%10:5]]},w=()=>{const e=document.createElement("div");e.classList.add("timer__segment");const t=document.createElement("span");t.classList.add("timer__number");const n=document.createElement("span");return n.classList.add("timer__units"),e.append(t,n),e.number=t,e.units=n,e},L=()=>{if(!document.querySelector("[data-timer-deadline]"))return;const e=(()=>{const e=document.createElement("h3");return e.classList.add("timer__title"),e.textContent="До конца акции:",e})(),{time:t,days:n,hours:a,minutes:c}=(()=>{const e=document.createElement("div");e.classList.add("timer__time");const t=w(),n=w(),a=w();return e.append(t,n,a),{time:e,days:t,hours:n,minutes:a}})(),r=document.querySelector("[data-timer-deadline]");r.append(e,t);const i=()=>{const e=r.dataset.timerDeadline,t=new Date(e).getTime()-(()=>{const e=new Date,t=e.getTimezoneOffset();return e.getTime()+60*(t+180)*1e3})(),{days:n,hours:a,minutes:c,seconds:i}=(e=>{const t=1e3;return{days:Math.floor(e/864e5),hours:Math.floor(e/36e5%24),minutes:Math.floor(e/6e4%60),seconds:Math.floor(e/t%60)}})(t);return{timeRemaining:t,days:n,hours:a,minutes:c,seconds:i}},s=()=>{const e=i();n.number.textContent=e.days.toString().padStart(2,"0"),n.units.textContent=S("days",e.days),a.number.textContent=e.hours.toString().padStart(2,"0"),a.units.textContent=S("hours",e.hours),c.number.textContent=e.minutes.toString().padStart(2,"0"),c.units.textContent=S("minutes",e.minutes);const t=setTimeout(s,1e3*e.seconds);e.timeRemaining<0&&(r.innerHTML="",clearTimeout(t))};s()},k=()=>{if(!document.querySelector("#categoryPage"))return;const t=new URLSearchParams(window.location.search).get("category");document.querySelector(".title").textContent=t,document.title=`${t} - ShopOnline`,(async t=>{const n=await r(e,`api/goods/category/${t}`);v(n.slice(0,32),"h2")})(t)},E=e=>{const t=document.querySelector(".breadcrumbs__list");t.innerHTML="",e.forEach(((n,a)=>{const c=document.createElement("li");if(c.className="breadcrumbs__item",a===e.length-1)c.textContent=n.title,c.ariaCurrent="page";else{const e=document.createElement("a");e.className="breadcrumbs__link underline-link",e.textContent=n.title,e.href=n.href,e.ariaLabel=n.ariaLabel,c.append(e)}t.append(c)}))},$=e=>{const t=e.querySelector(".cart-item__quantity"),n=e.querySelector(".cart-item__price"),a=e.querySelector(".cart-item__controls");window.innerWidth<=c.tablet?a.prepend(t):n.before(t)},x=t=>{const n=document.querySelector(".cart-items__list");return n.innerHTML="",t.forEach((t=>{const{cartItem:a}=(({id:t,title:n,image:a,price:c,discount:r,quantity:i})=>{const s=document.createElement("li");s.classList.add("cart-item"),s.dataset.id=t,s.innerHTML=`\n    <div class="cart-item__content">\n      <div class="cart-item__image-wrapper">\n        <label class="cart-item__label">\n          <input\n            class="cart-item__checkbox-input checkbox-input"\n            type="checkbox"\n            name="${n}"\n          >\n          <span class="cart-item__checkbox checkbox" aria-hidden="true"></span>\n        </label>\n        <a class="cart-item__image-link" href="product.html?id=${t}">\n        </a>\n      </div>\n\n      <div class="cart-item__details">\n        <div class="cart-item__main-info">\n          <h3 class="cart-item__title">\n            <a class="cart-item__link" href="product.html?id=${t}">\n              ${n}\n            </a>\n          </h3>\n          <div class="cart-item__description">\n            <span class="cart-item__description-line"></span>\n            <span class="cart-item__description-line"></span>\n          </div>\n        </div>\n\n        <div class="cart-item__quantity">\n          <button\n            class="cart-item__quantity-button button button--quantity"\n            aria-label="Минус один"\n          >−</button>\n          <span class="cart-item__quantity-number">${i}</span>\n          <button\n            class="cart-item__quantity-button button button--quantity"\n            aria-label="Плюс один"\n          >+</button>\n        </div>\n\n        <div class="cart-item__price">\n          <div class="cart-item__main-price">\n            ${r?`\n              <span class="cart-item__current-price">\n                ${_(p(c,r,i))}\n              </span>\n              <del class="cart-item__original-price">\n                ${_(c*i)}\n              </del>\n            `:`\n              <span class="cart-item__current-price">\n                ${_(c*i)}\n              </span>\n            `}\n          </div>\n          <span class="cart-item__credit-price">\n            ${_(h(c*i))}\n          </span>\n        </div>\n      </div>\n    </div>\n\n    <div class="cart-item__controls">\n      <button\n        class="cart-item__delete button button--delete"\n        aria-label="Удалить товар из корзины"\n      >\n        <svg width="18" height="23" aria-hidden="true">\n          <use href="img/sprite.svg#delete"></use>\n        </svg>\n      </button>\n    </div>\n  `;const{imageWrapper:o,image:l}=u({tag:"picture",className:"cart-item__image",src:`${e}${a}`,width:130,height:130,alt:n});return s.querySelector(".cart-item__image-link").append(o),$(s),window.addEventListener("resize",(()=>{$(s)})),{cartItem:s,image:l}})(t);n.append(a)})),{cartItems:n}},C=t=>{document.querySelector(".cart-delivery").classList.remove("skeleton");const n=document.querySelector(".cart-delivery__goods");n.innerHTML="",t.forEach((t=>{const a=(({id:t,title:n,image:a})=>{const c=document.createElement("li");return c.dataset.id=t,c.className="cart-delivery__goods-item",c.innerHTML=`\n    <a class="cart-delivery__goods-link" href="product.html?id=${t}">\n      <picture class="cart-delivery__goods-image">\n        <img src="${e}${a}" width="80" height="80" alt="${n}">\n      </picture>\n    </a>\n  `,c})(t);n.append(a)}))},N=e=>JSON.parse(localStorage.getItem(e))||[],M=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},T=e=>{const t=N(a).filter((t=>t.id!==e));M(a,t)};let P=[];const W=e=>{P=P.filter((t=>t.id!==e))},H=()=>{const e=document.querySelector(".actions__cart-counter"),t=document.querySelector(".cart-items__sup-title"),n=document.querySelector(".cart-summary__total-title"),c=(e=>e.reduce(((e,t)=>e+t.quantity),0))(N(a));e.style.display=c>0?"inline-flex":"none",e.textContent=c,t&&(t.textContent=c<=0?"":c),n&&(n.textContent=`Товары, ${c} шт.`)},A=e=>{document.querySelector(".cart-delivery__goods").querySelector(`[data-id="${e}"]`).remove()},I=()=>{const e=(e,t,n)=>{const a=document.querySelector(e);a.textContent=_(t),n.forEach((e=>a.classList.remove(e)))};e(".cart-summary__total",g(P),["cart-summary-skeleton__total","skeleton"]),e(".cart-summary__total-price",y(P),["cart-summary-skeleton__total-price","skeleton"]),e(".cart-summary__discount-price",(e=>y(e)-g(e))(P),["cart-summary-skeleton__discount-price","skeleton"])},O=(e="showContent")=>{const t=document.querySelector(".cart__content"),n=document.querySelector(".cart-empty");switch(e){case"showContent":t.classList.remove("hidden"),n.classList.add("hidden");break;case"showEmpty":t.classList.add("hidden"),n.classList.remove("hidden");break;default:console.error(`Unknown action: ${e}`)}},R=e=>{e.addEventListener("click",(({target:e})=>{if(e.closest(".cart-item__quantity")){const t=e.closest(".cart-item__quantity"),n=t.querySelector(".button--quantity"),c=t.querySelector(".cart-item__quantity-number"),r=t.querySelector(".button--quantity:last-child"),i=e.closest("[data-id]").dataset.id;let s=Number(c.textContent);e===n?s-=1:e===r&&(s+=1),c.textContent=s,n.disabled=1===s,((e,t)=>{P.find((t=>t.id===e)).quantity=t})(i,s),((e,t)=>{const n=N(a);n.find((t=>t.id===e)).quantity=t,M(a,n)})(i,s),(e=>{const t=document.querySelector(`[data-id="${e}"]`),{price:n,discount:a,quantity:c}=P.find((t=>t.id===e)),r=t.querySelector(".cart-item__current-price"),i=a?p(n,a,c):n*c;r.textContent=_(i);const s=t.querySelector(".cart-item__credit-price"),o=h(n,c);s.textContent=_(o);const l=t.querySelector(".cart-item__original-price");l&&(l.textContent=_(n*c))})(i),I(),H()}}))},U=async()=>{if(!document.querySelector("#cartPage"))return;document.title="Корзина - ShopOnline";const t=N(a);if(0===t.length)return O("showEmpty"),void q();O("showContent"),(e=>{const t=document.querySelector(".cart-items__list");Array.from({length:e}).forEach((()=>{const e=document.createElement("li");e.className="cart-item",e.innerHTML='\n      <div class="cart-item__content cart-item-skeleton__content">\n        <div class="cart-item__image-wrapper">\n          <label class="cart-item__label">\n            <input\n              class="cart-item__checkbox-input checkbox-input"\n              type="checkbox"\n              name="product-name"\n            >\n            <span class="cart-item__checkbox checkbox" aria-hidden="true">\n            </span>\n          </label>\n          <div class="cart-item__image-link skeleton"></div>\n        </div>\n        <div class="cart-item__details">\n          <div class="\n            cart-item__main-info\n            cart-item-skeleton__main-info\n            skeleton\n          "></div>\n          <div class="\n            cart-item__quantity\n            cart-item-skeleton__quantity\n            cart-item__quantity--tablet-hidden\n            skeleton\n          "></div>\n          <div class="\n            cart-item__price\n            cart-item-skeleton__price\n            skeleton\n          "></div>\n        </div>\n      </div>\n      <div class="cart-item__controls cart-item-skeleton__controls">\n        <div class="\n          cart-item__quantity\n          cart-item-skeleton__quantity\n          skeleton\n        "></div>\n        <button\n          class="cart-item__delete button button--delete"\n          aria-label="Удалить товар из корзины"\n        >\n          <svg width="18" height="23" aria-hidden="true">\n            <use href="img/sprite.svg#delete"></use>\n          </svg>\n        </button>\n      </div>\n  ',t.append(e)}))})(t.length),(e=>{const t=document.querySelector(".cart-delivery__goods");Array.from({length:e}).forEach((()=>{const e=document.createElement("li");e.className="cart-delivery__goods-item skeleton";const n=document.createElement("div");n.className="cart-delivery__goods-link",e.append(n),t.append(e)}))})(t.length),await(async t=>{for(const n of t){const t=await r(e,`api/goods/${n.id}`);t.quantity=n.quantity,P.push(t)}})(t);const{cartItems:n}=x(P);C(P),I(),q(),(()=>{const e=document.querySelector(".cart-items__checkbox-input");e.addEventListener("click",(()=>{document.querySelectorAll(".cart-item__checkbox-input").forEach((t=>t.checked=e.checked))}))})(),document.querySelector(".cart-items__delete").addEventListener("click",(()=>{document.querySelectorAll(".cart-item").forEach((e=>{if(e.querySelector(".cart-item__checkbox-input").checked){const t=e.dataset.id;e.remove(),W(t),0===P.length&&O("showEmpty"),T(t),A(t),I(),H()}}))})),R(n),(e=>{e.addEventListener("click",(({target:e})=>{if(e.closest(".cart-item__delete")){const t=e.closest(".cart-item"),n=t.dataset.id;t.remove(),W(n),0===P.length&&O("showEmpty"),T(n),A(n),I(),H()}}))})(n)},D=(e,t,n)=>{const a=document.createElement(e);return a.className=t,a.textContent=n,a},z=(t,n,a)=>{const{imageWrapper:c}=u({tag:"picture",className:"product__image",src:`${e}${n}`,width:"",height:"",alt:t}),r=document.createElement("div");r.className="product__image-wrapper",r.append(c),a&&r.append((e=>{const t=document.createElement("span");return t.classList.add("discount","discount--product"),t.textContent=`${e}%`,t})(a));document.querySelector(".product-skeleton__image-wrapper").replaceWith(r)},j=e=>{const t=document.querySelector(".product-card__add-to-favorite");N(n).includes(e)&&t.classList.add("is-active"),t.addEventListener("click",(()=>{var a;t.classList.toggle("is-active"),t.classList.contains("is-active")?(e=>{const t=N(n);t.includes(e)||(t.push(e),M(n,t))})(e):(a=e,M(n,N(n).filter((e=>e.id!==a))))}))},G=e=>{document.querySelector(".product-card__add-to-cart").addEventListener("click",(()=>{N(a).some((t=>t.id===e))||((e=>{const t=N(a);t.some((t=>t.id===e))||(t.push({id:e,quantity:1}),M(a,t))})(e),H())}))},J=async()=>{if(!document.querySelector("#productPage"))return;const t=new URLSearchParams(window.location.search).get("id"),{id:n,title:a,description:c,category:i,image:s,price:o,discount:l}=await r(e,`api/goods/${t}`),d=[{title:"Главная",href:"index.html",ariaLabel:"Вернуться на главную"},{title:"Каталог",href:"#",ariaLabel:"Вернуться в раздел каталог"},{title:`${i}`,href:`category.html?category=${i}`,ariaLabel:`Вернуться в раздел ${i}`},{title:`${a}`}];document.title=`${a} - ShopOnline`;document.querySelector(".product").classList.remove("skeleton"),E(d),(e=>{const t=document.createElement("h1");t.className="product__title title title--sm",t.textContent=e,document.querySelector(".product-skeleton__title").replaceWith(t)})(a),z(a,s,l),((e,t)=>{const n=document.createElement("div");if(n.className="product-card__price",t){const a=D("span","product-card__current-price",_(p(e,t)));n.append(a)}const a=D(t?"del":"span","product-card__original-price",_(e)),c=D("span","product-card__credit-price",`В кредит от ${_(h(e))}`);n.append(a,c),document.querySelector(".product-card-skeleton__price").replaceWith(n)})(o,l),(e=>{const t=document.createElement("div");t.className="product__description-content",t.innerHTML=`<p>${e}</p>`,document.querySelector(".product-skeleton__description-content").replaceWith(t)})(c),(async({id:t,category:n})=>{const a=(await r(e,`api/goods/category/${n}`)).filter((e=>e.id!==t));v(a.slice(0,8))})({id:n,category:i}),G(n),j(n)},F=async e=>{const t=document.querySelector(".blog__list");t.innerHTML="";const n=[];e.forEach(((e,a)=>{const c=document.createElement("li");c.classList.add("blog__item");const{post:r,image:i}=(({id:e,title:t},n)=>{const{imageWrapper:a,image:c}=u({tag:"div",className:"post-card__image",src:`https://loremflickr.com/400/400?${n}`,width:195,height:195,alt:t}),r=document.createElement("article");return r.classList.add("post-card"),r.innerHTML=`\n    ${a.outerHTML}\n    <div class="post-card__content">\n      <h2 class="post-card__title">\n        <a class="post-card__link" href="article.html?id=${e}">\n          ${t}\n        </a>\n      </h2>\n    </div>\n  `,{post:r,image:c}})(e,a);n.push(i),c.append(r),t.append(c)}));try{await m()}catch(e){console.error(e)}finally{f()}},X=(e,t)=>{const n=document.createElement("li");n.classList.add("pagination__item");const a=document.createElement("a");a.classList.add("pagination__link","page-num"),a.textContent=t,a.href=1===t?"blog.html":`blog.html?page=${t}`,a.ariaLabel=`Страница номер ${t}`,n.append(a),e.append(n)},B=(e,t)=>{const n=document.createElement("span");n.classList.add("pagination__dotted-line"),n.textContent="...";const a=document.createElement("li");a.classList.add("pagination__item"),a.append(n),1===t?(X(e,t),e.append(a)):(e.append(a),X(e,t))},K=(e,t)=>{const n=e-3+1,a=document.createElement("ul");if(a.classList.add("pagination__list","list-reset"),e<=3)for(let e=1;e<=3;e++)X(a,e);else if(t<=3){for(let e=1;e<=4;e++)X(a,e);B(a,e)}else if(n<=t){B(a,1);for(let t=n;t<=e;t++)X(a,t)}else{B(a,1);for(let e=t-1;e<=t+1;e++)X(a,e);B(a,e)}document.querySelector(".pagination").firstElementChild.after(a),(e=>{document.querySelectorAll(".page-num").forEach((t=>{t.classList.toggle("active",e===+t.textContent)}))})(t),((e,t)=>{const[n,a]=document.querySelectorAll(".pagination__link--arrow");1===t?n.classList.add("disabled"):(n.classList.remove("disabled"),n.href="blog.html?page="+(t-1)),t===e?a.classList.add("disabled"):(a.classList.remove("disabled"),a.href=`blog.html?page=${t+1}`)})(e,t)},Q=()=>{if(!document.querySelector("#blogPage"))return;document.title="Блог - ShopOnline";const e=new URLSearchParams(window.location.search);(async(e=1,{renderPosts:n,renderPagination:a})=>{const c=new URLSearchParams({page:e,per_page:12}),r=`${t}posts?${c}`;try{const t=await fetch(r);if(!t.ok)throw new Error("Failed to fetch posts");n(await t.json()),a(Number(t.headers.get("X-Pagination-Pages")),e)}catch(e){console.error("Error loading posts:",e)}})(e.has("page")?+e.get("page"):1,{renderPosts:F,renderPagination:K})},V=async()=>{if(!document.querySelector("#articlePage"))return;const e=new URLSearchParams(window.location.search).get("id"),{title:n,body:a,user_id:c}=await r(t,`posts/${e}`),{id:i,name:s}=await r(t,`users/${c}`)||{},o=[{title:"Главная",href:"index.html",ariaLabel:"Вернуться на главную"},{title:"Блог",href:"javascript:history.back()",ariaLabel:"Вернуться в раздел Блог"},{title:n}];document.title=`${n} - ShopOnline`,E(o),(e=>{const t=document.createElement("h1");t.className="article__title title title--md",t.textContent=e,document.querySelector(".article-skeleton__title").replaceWith(t)})(n),(e=>{const t=document.querySelector(".article__content");t.innerHTML="";const n=document.createElement("p");n.className="article__text",n.textContent=e,t.append(n)})(a),((e,t)=>{const n=document.createElement("a");n.className="article__author underline-link",n.href=`user.html?id=${e||"#"}`,n.textContent=t||"Unknown",document.querySelector(".article-skeleton__author").replaceWith(n)})(i,s),f()};(async()=>{d(),document.querySelector("#homePage")&&(window.addEventListener("DOMContentLoaded",L),q()),k(),J(),U(),Q(),V(),H()})()}();